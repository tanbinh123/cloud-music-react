{"version":3,"sources":["webpack:///./src/application/Singer/index.jsx","webpack:///./src/application/Singer/style.js"],"names":["Singer","props","initialHeight","useRef","useState","showStatus","setShowStatus","OFFSET","id","match","params","artist","hotSongs","songsCount","enterLoading","getSingerDataDispatch","artists","toJS","songs","headerRef","layRef","imgWrapperRef","scrollSongWrapperRef","collectionButtonRef","songsRef","musicNoteRef","useEffect","h","current","offsetHeight","style","top","refresh","handleBack","useCallback","handleScroll","pos","height","newY","y","imageDom","buttonDom","scrollSongWrapperDom","layDom","headerDom","minScrollY","getBoundingClientRect","percent","Math","abs","transform","paddingTop","zIndex","opacity","musicAnimation","x","startAnimation","history","goBack","name","picUrl","mapStateToProps","state","getIn","size","mapDispatchToProps","dispatch","changeSingerEnterLoading","getSingerInfo","connect","React","memo","Container","Styled","div","ImgWrapper","background","CollectionButton","BgLayer","SongListWrapper","play"],"mappings":"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","file":"11-02126968290396a71cc6.js","sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from 'react'\nimport { connect } from \"react-redux\"\nimport { CSSTransition } from \"react-transition-group\"\nimport { Container, ImgWrapper, CollectionButton, BgLayer, SongListWrapper } from \"./style\"\nimport { getSingerInfo, changeSingerEnterLoading } from \"./store/actionCreator\"\nimport Header from \"baseUI/header\"\nimport Scroll from \"baseUI/scroll\"\nimport SongList from \"../SongList\"\nimport EnterLoading from \"utils/EnterLoading\"\nimport Loading from \"baseUI/loading\"\nimport MusicNote from \"baseUI/music-note\"\nfunction Singer(props) {\n\n  // 维护一个初始化的高度的状态\n  const initialHeight = useRef(0);\n  const [showStatus, setShowStatus] = useState(true);\n  const OFFSET = 5;\n  const id = props.match.params.id\n\n  const { artist, hotSongs, songsCount, enterLoading } = props;\n  const { getSingerDataDispatch } = props;\n\n  const artists = artist.toJS();\n  const songs = hotSongs.toJS();\n  const headerRef = useRef();\n  const layRef = useRef();\n  const imgWrapperRef = useRef();\n  const scrollSongWrapperRef = useRef();\n  const collectionButtonRef = useRef();\n  const songsRef = useRef();\n  const musicNoteRef = useRef();\n  useEffect(() => {\n    getSingerDataDispatch(id);\n  }, [getSingerDataDispatch, id]);\n\n  useEffect(() => {\n    if (!enterLoading) {\n      // 获取图片的高度\n      let h = imgWrapperRef.current.offsetHeight;\n      initialHeight.current = h;\n      // 需要为滚动区域的list设置top值\n      scrollSongWrapperRef.current.style.top = `${(h - OFFSET) / 100}rem`\n      layRef.current.style.top = `${(h - OFFSET) / 100}rem`\n      songsRef.current.refresh();\n    }\n  }, [enterLoading])\n\n\n  const handleBack = useCallback(() => {\n    setShowStatus(false);\n  }, []);\n\n  const handleScroll = (pos) => {\n    // 获取初始化的值\n    let height = initialHeight.current;\n    let newY = pos.y;\n    let imageDom = imgWrapperRef.current;\n    let buttonDom = collectionButtonRef.current;\n    let scrollSongWrapperDom = scrollSongWrapperRef.current;\n    let layDom = layRef.current;\n    let headerDom = headerRef.current;\n    // 最小的高度\n    let minScrollY = -(height - OFFSET - headerDom.getBoundingClientRect().height);\n    // 通过总高度的变化计算每次的百分比算法\n    // 当percent的为1的时候说明已经完成达到需要最顶端的位置 这个时候我们需要将图片的z-index的设置\n    const percent = Math.abs(newY / height);\n    /* \n      分为newY大于0的情况和newY小于零的情况\n    \n    */\n    if (newY > 0) {\n      //  说明是向下滑动需要将图片的内容向下拉动同时图片进行放大的效果\n      // transform:scale变大\n      imageDom.style.transform = `scale(${1 + percent})`;\n      // button按钮的文职也需要向下移动\n      buttonDom.style.transform = `translate3d(0, ${newY / 100}rem, 0)`;\n      // layDom文职也需要改变\n      layDom.style.top = `${(height - OFFSET + Math.abs(newY)) / 100}rem`\n\n    } else if (newY >= minScrollY) {\n      //  y轴的坐标大于最小可滚动的值，\n      layDom.style.top = `${(height - OFFSET - Math.abs(newY)) / 100}rem`;\n      imageDom.style.paddingTop = \"75%\";\n      imageDom.style.height = 0;\n      imageDom.style.zIndex = -1;\n      // button按钮的动画效果\n      buttonDom.style.transform = `translate3d(0, ${newY / 100}rem, 0)`;\n      buttonDom.style.opacity = `${1 - percent * 2}`;\n    } else if (newY < minScrollY) {\n      // 说明达到我这是的最大滚动的距离这个时候需要让header显示\n      headerDom.style.zIndex = 100;\n      imageDom.style.paddingTop = 0;\n      imageDom.style.height = `${headerDom.getBoundingClientRect().height / 100}rem`;\n      imageDom.style.zIndex = 99;\n    }\n  }\n  const musicAnimation = (x, y) => {\n    musicNoteRef.current.startAnimation({ x, y });\n  };\n  return (\n    <CSSTransition\n      in={showStatus}\n      timeout={300}\n      appear={true}\n      classNames=\"fly\"\n      mountOnEnter\n      unmountOnExit\n      onExited={props.history.goBack}\n    >\n      {/* 整个内容区域 */}\n      <Container play={songsCount}>\n        {\n          enterLoading ? <EnterLoading><Loading style={{ zIndex: 100 }}></Loading></EnterLoading> : (\n            <>\n              <Header\n                handleClick={handleBack}\n                title={artists.name}\n                ref={headerRef}\n              ></Header>\n              <ImgWrapper ref={imgWrapperRef} background={artists.picUrl}>\n                <div className=\"filter\"></div>\n              </ImgWrapper>\n              <CollectionButton ref={collectionButtonRef}>\n                <i className=\"iconfont\">&#xe62d;</i>\n                <span className=\"text\">收藏</span>\n              </CollectionButton>\n              <BgLayer ref={layRef}></BgLayer>\n              <SongListWrapper ref={scrollSongWrapperRef} play={songsCount}>\n                <Scroll\n                  onScroll={handleScroll}\n                  ref={songsRef}\n                >\n                  <SongList\n                    songs={songs}\n                    showCollect={false}\n                    musicAnimation={musicAnimation}\n                  ></SongList>\n                </Scroll>\n              </SongListWrapper>\n              <MusicNote ref={musicNoteRef}></MusicNote>\n            </>)\n        }\n      </Container>\n\n    </CSSTransition>\n  )\n}\nconst mapStateToProps = state => ({\n  artist: state.getIn([\"singerInfo\", \"artist\"]),\n  hotSongs: state.getIn([\"singerInfo\", \"hotSongs\"]),\n  songsCount: state.getIn([\"player\", \"playList\"]).size,\n  enterLoading: state.getIn([\"singerInfo\", \"enterLoading\"])\n});\nconst mapDispatchToProps = dispatch => ({\n  getSingerDataDispatch(id) {\n    dispatch(changeSingerEnterLoading(true))\n    dispatch(getSingerInfo(id));\n  }\n})\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Singer));","import Styled from \"styled-components\"\nimport style from \"assets/global-style\"\nexport const Container = Styled.div`\n  position : fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom : 0;\n  z-index: 100;\n  width: 100%;\n  overflow: hidden;\n  background : #f2f3f4;\n  transform-origin : right bottom;\n  &.fly-enter, &.fly-appear{\n    transform: rotateZ(30deg) translate3d(100%, 0, 0);\n  }\n  &.fly-enter-active, &.fly-appear-active{\n    transition: transform .3s;\n    transform: rotateZ(0deg) translate3d(0, 0, 0);\n  }\n  &.fly-exit{\n    transform: rotateZ(0deg) translate3d(0, 0, 0);\n  }\n  &.fly-exit-active{\n    transition: transform .3s;\n    transform: rotateZ(30deg) translate3d(100%, 0, 0);\n  }\n`\n\nexport const ImgWrapper = Styled.div`\n  position : relative;\n  width: 100%;\n  height: 0;\n  padding-top : 75%;\n  transform-origin: top;\n  background: url(${props => props.background});\n  background-size: cover;\n  z-index: 50;\n  .filter {\n    position : absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background : rgba(7,17,27,0.3);\n  }\n`\nexport const CollectionButton = Styled.div`\n  position : fixed;\n  left: 0;\n  right: 0;\n  margin: 0 auto;\n  box-sizing : border-box;\n  width : 1.2rem;\n  height : .4rem;\n  z-index : 50;\n  color : ${style[\"font-color-light\"]};\n  background : ${style[\"theme-color\"]};\n  border-radius : .2rem;\n  text-align : center;\n  font-size : 0;\n  line-height : .4rem;\n  margin-top : -.55rem;\n  .iconfont {\n    display : inline-block;\n    margin-right : .1rem;\n    font-size : .12rem;\n    vertical-align : .01rem;\n  }\n  .text {\n    display : inline-block;\n    font-size : .14rem;\n    letter-spacing : .05rem;\n  }\n`\nexport const BgLayer = Styled.div`\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 100%;\n  background: white;\n  border-radius: .1rem;\n  z-index: 50;\n`\nexport const SongListWrapper = Styled.div`\n  position: absolute;\n  z-index: 50;\n  top: 0;\n  left: 0;\n  bottom: ${props => props.play ? \".6rem\" : 0};\n  right: 0;\n  >div{\n    position: absolute;\n    left: 0;\n    width: 100%;\n    overflow: visible;\n  }\n`"],"sourceRoot":""}